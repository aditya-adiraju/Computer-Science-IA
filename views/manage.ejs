<%- include('./layouts/header') %>
<style>
    .table-container {
        overflow-x: scroll;
    }
    table {
        margin-top: 32px;
        width: 100%;
        border: thick solid black ;
        border-spacing: 0;
        padding: 16px;
        border-radius: 16px;
    }
    table th{
        padding: 10px;
        border: medium solid black
    }
    table td{
        padding: 10px;
        border: thin solid black
    }
</style>

<script>
      function openForm() {
        document.getElementById("popupForm").style.display = "block";
    }

</script>
<body>
<form id="LOGOUT" action="/logout?_method=DELETE" method="POST"></form>
<h1 style="text-align:center;" >CISMUN ONLINE DATABASE</h1>
<h2 style="text-align:center;">Manage Accounts</h2>
<div class="table-container">
    <table class="table">
    <thead>
        <th>ID</th>
        <th>Name</th>
        <th>School</th>
        <th>Delegate Quota</th>
        <th>Email</th>
        <th>Role</th>
    </thead>
    <tbody>
        <% users.forEach(user => { %>
        <tr>
        <td><%= user.id %></td>
        <td><%= user.name %></td>
        <td><%= user.school %></td>
        <td><%= user.quota %></td>
        <td><a href="/user/<%= user.id %>"><%= user.email %></a></td>
        <td>
            <form action="/admin/update-role" method="post">
            <input type="hidden" name="id" value="<%= user.id %>" />
            <select name="role" id="role">
                <option value="ADMIN" <%= user.role === 'ADMIN' ? 'selected' : '' %> >Admin</option>
                <option value="CLIENT" <%= user.role === 'CLIENT' ? 'selected' : '' %>>Client</option>
            </select>
            <input type="submit" class="button" value="update">
            </form>
        </td>
        </tr>
        <% }) %>
    </tbody>
    </table>
</div>
<br><br>
<span class="center"> <button class="button" onclick="openForm()" style="max-width: 100%, ">Assign Quota</button></span>
<div class="loginPopup">
    <div class="formPopup" id="popupForm">
      <form action="/admin/modify-quota" method="POST">
          <h2 style="text-align:center;">Assign Quota</h2>
          <div class="container" style="padding-left:2%">
              <label for="id">Select Account: </label>
              <select class="input" name="id" required>
                  <% users.forEach(user => { %>
                    <option value="<%= user.id %> "><%= user.id + " - " + user.name %> </option>
                  <% }) %>
              </select>   
              <label for="quota">Quota: </label>
              <input class="input" type="number" id="quota" name="quota" required>
          </div>
          <br><br>
          <button class="button" type="submit">ADD</button>
          <button type="button" class="button" onclick="closeForm()">CLOSE</button>
          <br><br>
      </form>
    </div>
  </div>